<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>donaYa Widget</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }
      .animate-scale-up {
        animation: scaleUp 0.3s ease-out;
      }
      @keyframes scaleUp {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <div id="widget-root"></div>

    <script>
      // Widget donaYa - Versión Standalone
      class DonaYaWidget {
        constructor(config = {}) {
          this.config = {
            organizationId: config.org || "default",
            theme: config.theme || "default",
            color: config.color || "#10B981",
            ...config,
          };
          this.init();
        }

        init() {
          this.render();
          this.setupEventListeners();
        }

        render() {
          const root = document.getElementById("widget-root");
          root.innerHTML = `
                    <div class="min-h-screen bg-white">
                        <!-- Header -->
                        <div class="bg-white shadow-sm p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="bg-green-500 p-2 rounded-lg mr-3">
                                        <i data-lucide="heart" class="text-white w-6 h-6"></i>
                                    </div>
                                    <h1 class="text-2xl font-bold text-gray-800">donaYa</h1>
                                </div>
                                <button id="close-widget" class="p-2 hover:bg-gray-100 rounded-full">
                                    <i data-lucide="x" class="w-6 h-6 text-gray-600"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="p-6">
                            <div class="text-center mb-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Elige cómo ayudar</h2>
                                <p class="text-gray-600">Selecciona una categoría de donación</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="donation-options">
                                <!-- Options will be rendered here -->
                            </div>
                        </div>
                    </div>
                `;

          this.renderDonationOptions();
          lucide.createIcons();
        }

        renderDonationOptions() {
          const options = [
            {
              id: "food",
              title: "Donar para comida",
              icon: "bread",
              color: "text-blue-600",
              bgColor: "bg-blue-100",
              description: "Ayuda a proporcionar alimentos nutritivos",
            },
            {
              id: "clothing",
              title: "Donar para ropa",
              icon: "shirt",
              color: "text-green-600",
              bgColor: "bg-green-100",
              description: "Contribuye con vestimenta adecuada",
            },
            {
              id: "housing",
              title: "Donar para hogar",
              icon: "home",
              color: "text-blue-600",
              bgColor: "bg-blue-100",
              description: "Apoya la construcción de viviendas",
            },
            {
              id: "voluntary",
              title: "Donación voluntaria",
              icon: "heart",
              color: "text-green-600",
              bgColor: "bg-green-100",
              description: "Contribución libre para todas las causas",
            },
          ];

          const container = document.getElementById("donation-options");
          container.innerHTML = options
            .map(
              (option) => `
                    <div class="p-6 rounded-xl border-2 border-gray-200 hover:border-green-500 cursor-pointer transition-all duration-300 hover:shadow-lg group flex flex-col items-center text-center" data-option="${option.id}">
                        <div class="p-4 rounded-full ${option.bgColor} mb-4 group-hover:scale-110 transition-transform">
                            <i data-lucide="${option.icon}" class="w-8 h-8 ${option.color}"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${option.title}</h3>
                        <p class="text-gray-600 text-sm">${option.description}</p>
                        <i data-lucide="arrow-right" class="w-4 h-4 mt-4 text-green-500 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                    </div>
                `
            )
            .join("");

          lucide.createIcons();
        }

        setupEventListeners() {
          // Close button
          document
            .getElementById("close-widget")
            .addEventListener("click", () => {
              this.close();
            });

          // Donation options
          document.querySelectorAll("[data-option]").forEach((option) => {
            option.addEventListener("click", (e) => {
              const optionId = e.currentTarget.getAttribute("data-option");
              this.handleDonation(optionId);
            });
          });
        }

        handleDonation(optionId) {
          const optionNames = {
            food: "comida",
            clothing: "ropa",
            housing: "hogar",
            voluntary: "donación voluntaria",
          };

          Swal.fire({
            title: "¡Gracias por tu generosidad!",
            html: `
                        <div class="text-center">
                            <div class="bg-green-100 p-4 rounded-lg mb-4">
                                <i data-lucide="heart" class="w-12 h-12 text-green-600 mx-auto mb-2"></i>
                                <p class="text-lg font-semibold text-gray-800">Donación para ${optionNames[optionId]}</p>
                            </div>
                            <p class="text-gray-600 mb-4">
                                Tu donación ayudará directamente a familias en situación vulnerable.
                            </p>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm text-blue-800">
                                    <strong>Nota:</strong> Esta es una demostración. Para donaciones reales, 
                                    contacta con las organizaciones directamente.
                                </p>
                            </div>
                        </div>
                    `,
            icon: "success",
            confirmButtonText: "Entendido",
            confirmButtonColor: "#10B981",
            showCancelButton: true,
            cancelButtonText: "Ver más información",
            cancelButtonColor: "#3B82F6",
          }).then((result) => {
            if (result.dismiss === Swal.DismissReason.cancel) {
              this.showMoreInfo(optionId);
            }
          });

          // Recreate icons after SweetAlert
          setTimeout(() => lucide.createIcons(), 100);
        }

        showMoreInfo(optionId) {
          const info = {
            food: {
              title: "Comida para familias",
              description:
                "Ayuda a proporcionar alimentos nutritivos a familias que lo necesitan.",
              link: "https://www.eatcloud.com/comida-pa-mi-gente",
            },
            clothing: {
              title: "Ropa para todos",
              description:
                "Contribuye con vestimenta adecuada para personas en situación vulnerable.",
              link: "https://www.fundesoe.org/copy-of-primera-infancia",
            },
            housing: {
              title: "Hogares dignos",
              description:
                "Apoya la construcción y mejora de viviendas dignas.",
              link: "https://colombia.techo.org",
            },
            voluntary: {
              title: "Donación general",
              description:
                "Contribución libre para apoyar todas nuestras causas.",
              link: "https://unicef.org.co/donar",
            },
          };

          const data = info[optionId];

          Swal.fire({
            title: data.title,
            text: data.description,
            icon: "info",
            confirmButtonText: "Visitar sitio web",
            confirmButtonColor: "#3B82F6",
            showCancelButton: true,
            cancelButtonText: "Cerrar",
          }).then((result) => {
            if (result.isConfirmed) {
              window.open(data.link, "_blank");
            }
          });
        }

        close() {
          // Notificar al parent window que se cierre
          if (window.parent !== window) {
            window.parent.postMessage({ type: "donaya-close" }, "*");
          }
        }
      }

      // Inicializar widget cuando se carga la página
      document.addEventListener("DOMContentLoaded", () => {
        // Obtener parámetros de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const config = {
          org: urlParams.get("org"),
          theme: urlParams.get("theme"),
          color: urlParams.get("color"),
        };

        new DonaYaWidget(config);
      });

      // Escuchar mensajes del parent window
      window.addEventListener("message", (event) => {
        if (event.data.type === "donaya-close") {
          // Cerrar el widget si se recibe el mensaje
          document.body.style.display = "none";
        }
      });
    </script>
  </body>
</html>
